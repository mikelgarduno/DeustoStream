<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Cat치logo - DeustoStream</title>
    <link rel="stylesheet" th:href="@{/styles.css}" href="../static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=DM+Sans:wght@400;600&display=swap"
        rel="stylesheet">

    <script>
        async function guardarPeliculaFavoritos(idPelicula, idUsuario) {

            await fetch(`/api/usuarios/${idUsuario}/peliculas/${idPelicula}`, {
                method: 'POST',
                credentials: 'same-origin' // Asegura enviar las cookies de sesi칩n
            });
            
        }
        async function guardarSerieFavoritos(idSerie, idUsuario) {

            await fetch(`/api/usuarios/${idUsuario}/series/${idSerie}`, {
                method: 'POST',
                credentials: 'same-origin' // Asegura enviar las cookies de sesi칩n
            });
        }
    </script>

</head>

<body>
    <header class="main-header">
        <div class="header-left">
            <a th:href="@{/catalogo}" class="logo-link">
                <img th:src="@{/images/logoDeustoStream.png}" alt="Logo DeustoStream" class="logo-small">
            </a>
            <h1 class="catalogo-title">Cat치logo de DeustoStream</h1>
        </div>

        <nav class="header-nav">
            <a href="/catalogo">游닄 Cat치logo</a>
            <a href="/peliculas">游꿟 Pel칤culas</a>
            <a href="/series">游닠 Series</a>
            <a href="/suscripcion">游눱 Suscripci칩n</a>
        </nav>

        <div class="header-right">
            <a href="/perfil">
                <img th:src="@{|/images/${avatar}.jpg|}" alt="Foto de perfil" class="perfil-img">
            </a>
            <button class="logout-btn" onclick="window.location.href='/logout'">Cerrar sesi칩n</button>
            <button class="favoritos-btn" onclick="window.location.href='/guardados'">Ver favoritos</button>
        </div>
    </header>
    
    <div class="filtro">
        <form action="#" method="get" class="filtro-form">
            <input type="text" name="titulo" placeholder="Buscar por t칤tulo..." th:value="${param.titulo}">
            <div class="anio-filter">
                <button type="submit" name="anio" value="2000" th:classappend="${param.anio=='2000'} ? 'selected' : ''">
                    Nueva
                </button>
                <button type="submit" name="anio" value="1999" th:classappend="${param.anio=='1999'} ? 'selected' : ''">
                    Vieja
                </button>
            </div>
            <label for="duracion">Duraci칩n (min):</label>
            <input type="range" id="duracion" name="duracion" min="60" max="250" value="250" oninput="durOutput.value = this.value">
            <output id="durOutput">250</output>
            
            <select name="genero">
                <option value="">-- G칠nero --</option>
                <option th:each="g : ${generos}"
                        th:value="${g}"
                        th:text="${g}"
                        th:selected="${param.genero == g}">G칠nero</option>
            </select>
        
            <button type="submit">Filtrar</button>
            <a th:href="@{/catalogo}" class="btn-reset">Limpiar filtros</a>
        </form>
    </div>


    <div class="catalogo">
        <!-- Secci칩n de Pel칤culas -->
        <div class="seccion">
            <h2>游꿘 Pel칤culas</h2>
            <div class="contenedor-peliculas">
                <div class="pelicula" th:each="pelicula : ${peliculas}">
                    <!-- Enlace a la p치gina de detalles de la pel칤cula -->
                    <a th:href="@{/pelicula/{id}(id=${pelicula.id})}">
                        <img class="poster" th:src="${pelicula.imagenUrl}" alt="P칩ster de pel칤cula">
                        <h3 th:text="${pelicula.titulo}"></h3>
                        <p th:text="${pelicula.genero}"></p>
                    </a>
                    <!-- Bot칩n para a침adir a favoritos -->
                    <button class="favoritos-btn" th:if="${#lists.contains(peliculasFavoritas, pelicula)}"
                        th:onclick="'guardarPeliculaFavoritos(' + ${pelicula.id} + ', ' + ${usuario.id} + ')'">
                        仇벒잺 Borrar
                    </button>

                    <button class="favoritos-btn" th:if="${!#lists.contains(peliculasFavoritas, pelicula)}"
                        th:onclick="'guardarPeliculaFavoritos(' + ${pelicula.id} + ', ' + ${usuario.id} + ')'">
                        仇벒잺 Guardar
                    </button>
                </div>
            </div>
        </div>

        <!-- Secci칩n de Series -->
        <div class="seccion">
            <h2>游닠 Series</h2>
            <div class="contenedor-series">
                <div class="serie" th:each="serie : ${series}">
                    <a th:href="@{/serie/{id}(id=${serie.id})}">
                        <img class="poster" th:src="${serie.imagenUrl}" alt="P칩ster de serie">
                        <h3 th:text="${serie.titulo}"></h3>
                        <p th:text="${serie.genero}"></p>
                    </a>
                    <!-- Bot칩n para a침adir a favoritos -->
                    <button class="favoritos-btn" th:if="${#lists.contains(seriesFavoritas, serie)}"
                        th:onclick="'guardarSerieFavoritos(' + ${serie.id} + ', ' + ${usuario.id} + ')'">
                        仇벒잺 Borrar
                    </button>

                    <button class="favoritos-btn" th:if="${!#lists.contains(seriesFavoritas, serie)}"
                        th:onclick="'guardarSerieFavoritos(' + ${serie.id} + ', ' + ${usuario.id} + ')'">
                        仇벒잺 Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Cat谩logo - DeustoStream</title>
    <link rel="stylesheet" th:href="@{/styles.css}" href="../static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=DM+Sans:wght@400;600&display=swap"
        rel="stylesheet">

    <script>
        async function guardarPeliculaFavoritos(idPelicula, idUsuario) {

            await fetch(`/api/usuarios/${idUsuario}/peliculas/${idPelicula}`, {
                method: 'POST',
                credentials: 'same-origin' // Asegura enviar las cookies de sesi贸n
            });
            
        }
        async function guardarSerieFavoritos(idSerie, idUsuario) {

            await fetch(`/api/usuarios/${idUsuario}/series/${idSerie}`, {
                method: 'POST',
                credentials: 'same-origin' // Asegura enviar las cookies de sesi贸n
            });
        }
    </script>

</head>

<body>
    <header>
        <h1>Catalogo de DeustoStream</h1>
        <button class="logout-btn" onclick="window.location.href='/logout'">Cerrar sesi贸n</button>
        <button class="favoritos-btn" onclick="window.location.href='/guardados'">Ver favoritos</button>
    </header>

    <nav class="navbar">
        <a href="/catalogo"> Cat谩logo</a>
        <a href="/peliculas"> Pel铆culas</a>
        <a href="/series"> Series</a>
    </nav>
    

    <div class="filtro">
        <h2>Filtrar por t铆tulo</h2>
        <form action="#" method="get" class="filtro-form">
            <input type="text" name="titulo" placeholder="Buscar por t铆tulo..." th:value="${param.titulo}">
            
            <select name="genero">
                <option value="">-- G茅nero --</option>
                <option th:each="g : ${generos}"
                        th:value="${g}"
                        th:text="${g}"
                        th:selected="${param.genero == g}">G茅nero</option>
            </select>
        
            <button type="submit">Filtrar</button>
            <a th:href="@{/catalogo}" class="btn-reset">Limpiar filtros</a>
        </form>
    </div>


    <div class="catalogo">
        <!-- Secci贸n de Series -->
        <div class="seccion">
            <h2> Series</h2>
            <div class="contenedor-series">
                <div class="serie" th:each="serie : ${series}">
                    <a th:href="@{/serie/{id}(id=${serie.id})}">
                        <img class="poster" th:src="${serie.imagenUrl}" alt="P贸ster de serie">
                        <h3 th:text="${serie.titulo}"></h3>
                        <p th:text="${serie.genero}"></p>
                    </a>
                    <!-- Bot贸n para a帽adir a favoritos -->
                    <button class="favoritos-btn" th:if="${#lists.contains(seriesFavoritas, serie)}"
                        th:onclick="'guardarSerieFavoritos(' + ${serie.id} + ', ' + ${usuario.id} + ')'">
                        わ Borrar
                    </button>

                    <button class="favoritos-btn" th:if="${!#lists.contains(seriesFavoritas, serie)}"
                        th:onclick="'guardarSerieFavoritos(' + ${serie.id} + ', ' + ${usuario.id} + ')'">
                        わ Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>